<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">

	<div class="container">
		<div class="row">
			<div class="col-xs-12">
				<f:view>
					<div class="form_main col-xs-8">
						<p:panel header="Task Details">
							<div>

								<h:form id="mainForm">
									<div class="form-group">
										<p:remoteCommand name="rc" update="mainForm tableForm"
											action="#{taskController.saveAsCompleted(taskController.taskModel.id)}"
											rendered="#{!taskController.taskModel.completed and not empty taskController.taskModel.id}" />
										<p:commandButton type="button" onclick="rc()"
											value="Set As Completed"
											rendered="#{!taskController.taskModel.completed and not empty taskController.taskModel.id}" />
										<i class="pi pi-check" style="font-size: 3em"></i>
									</div>
									<div class="form-group">
										<p:outputLabel value="Title:" />
										<p:inputText value="#{taskController.taskModel.title}"
											styleClass="form-control" pt:placeholder="Title"
											autocomplete="false"></p:inputText>
										<p:message for="@previous" />
									</div>
									<div class="form-group">
										<p:outputLabel value="Description:" />
										<p:inputTextarea
											value="#{taskController.taskModel.description}"
											styleClass="form-control" pt:placeholder=" Description"></p:inputTextarea>
									</div>
									<div class="form-row col-xs-12">
										<div class="form-group col-xs-6"
											style="padding-left: 0px; margin-left: -15px">
											<p:outputLabel for="cStartDate" value="Start date:" />
											<p:calendar id="cStartDate"
												value="#{taskController.taskModel.startDate}"
												pattern="yyyy-MM-dd" converter="localDateTimeConverter"
												inputStyleClass="form-control" />
										</div>
										<div class="form-group col-xs-6">
											<p:outputLabel for="cDueDate" value="Due date:" />
											<p:calendar id="cDueDate"
												value="#{taskController.taskModel.dueDate}"
												pattern="yyyy-MM-dd" converter="localDateTimeConverter"
												inputStyleClass="form-control" />
										</div>
									</div>

									<hr />
									<p:commandButton class="btn btn-primary" value="Save"
										action="#{taskController.saveTask(taskController.taskModel.id)}"
										ajax="false" update="mainForm" />
									<p:commandButton class="btn" value="Delete"
										action="#{taskController.deleteTask(taskController.taskModel.id)}"
										disabled="#{empty taskController.taskModel.id}" ajax="false"
										update="mainForm" />
									<p:commandButton class="btn" value="Clear"
										action="#{taskController.clearTask()}"
										disabled="#{empty taskController.taskModel.id}"
										update="mainForm" />

								</h:form>

							</div>
						</p:panel>
					</div>

					<div class="form_main col-xs-12">
						<hr />
						<!-- new -->
						<p:tabView>
							<p:ajax event="tabChange"
								listener="#{taskController.getTasksByStatus}"
								update="tableForm mainForm" resetValues="true" />
							<p:tab title="Pending">
								<f:attribute name="statusId" value="0" />
							</p:tab>
							<p:tab title="Completed">
								<f:attribute name="statusId" value="1" />
							</p:tab>
						</p:tabView>
						<!-- new -->
						<h:form id="tableForm">

							<p:dataTable id="tasks" var="taskModel"
								value="#{taskController.taskListModel}" selectionMode="single"
								selection="#{taskController.selectedTaskModel}"
								rowKey="#{taskModel.id}"
								rowStyleClass="#{taskModel.delayedDays > 0 and !taskModel.completed ? 'danger' : taskModel.delayedDays == 0? 'warning':null}">
								<f:facet name="header">Tasks</f:facet>
								<p:ajax event="rowSelect"
									listener="#{taskController.onRowSelect}" update="mainForm"
									resetValues="true" />
								<p:column headerText="Title">
									<h:outputText value="#{taskModel.title}" />
								</p:column>
								<p:column headerText="Due">
									<h:outputText value="#{taskModel.dueDate}">
									</h:outputText>
								</p:column>
								<p:column headerText="CreatedOn">
									<h:outputText
										value="#{taskController.formatDateTime(taskModel.createdDate)}">
									</h:outputText>
								</p:column>
								<p:column headerText="Elapsed Days">
									<h:outputText value="#{taskModel.delayedDays}" />
								</p:column>
								<p:column headerText="Completed On">
									<h:outputText
										value="#{taskController.formatDate(taskModel.completedDate)}">
									</h:outputText>
								</p:column>
							</p:dataTable>
						</h:form>
					</div>

				</f:view>
			</div>
		</div>
	</div>

</ui:composition>
